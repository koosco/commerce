<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toss Payments í…ŒìŠ¤íŠ¸</title>
  <script src="https://js.tosspayments.com/v2/standard"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #555;
      font-weight: 500;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      background-color: #3182f6;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #1b64da;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    #payment-method {
      margin: 20px 0;
      min-height: 100px;
    }
    #agreement {
      margin: 20px 0;
    }
    .info {
      background-color: #f0f7ff;
      border-left: 4px solid #3182f6;
      padding: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      color: #333;
    }
    .error {
      background-color: #fff5f5;
      border-left: 4px solid #f44336;
      padding: 12px;
      margin-top: 20px;
      display: none;
      color: #d32f2f;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’³ Toss Payments í…ŒìŠ¤íŠ¸</h1>

    <div class="info">
      <strong>í…ŒìŠ¤íŠ¸ ëª¨ë“œ</strong><br>
      ì‹¤ì œ ê²°ì œê°€ ì§„í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </div>

    <div class="form-group">
      <label for="amount">ê²°ì œ ê¸ˆì•¡</label>
      <input type="number" id="amount" value="10000" min="1000" step="100">
    </div>

    <div class="form-group">
      <label for="orderName">ì£¼ë¬¸ëª…</label>
      <input type="text" id="orderName" value="í…ŒìŠ¤íŠ¸ ìƒí’ˆ" placeholder="ì£¼ë¬¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>

    <div class="form-group">
      <label for="customerName">êµ¬ë§¤ìëª…</label>
      <input type="text" id="customerName" value="í™ê¸¸ë™" placeholder="êµ¬ë§¤ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>

    <div class="form-group">
      <label for="customerEmail">ì´ë©”ì¼</label>
      <input type="email" id="customerEmail" value="test@example.com" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>

    <!-- ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ ì˜ì—­ -->
    <div id="payment-method"></div>

    <!-- ì•½ê´€ ë™ì˜ ì˜ì—­ -->
    <div id="agreement"></div>

    <button id="payment-button">ê²°ì œí•˜ê¸°</button>

    <div class="error" id="error-message"></div>
  </div>

  <script>
    // âš ï¸ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ í‚¤ë¥¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤
    // ê²°ì œìœ„ì ¯ ì—°ë™ í‚¤ (test_gckë¡œ ì‹œì‘)
    const clientKey = 'test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm';
    const customerKey = 'test_customer_' + Date.now(); // ê³ ìœ í•œ ê³ ê° ì‹ë³„ì

    let paymentWidget;

    // Payment Widget ì´ˆê¸°í™”
    async function initializePaymentWidget() {
      try {
        // TossPayments SDK ì´ˆê¸°í™”
        const tossPayments = TossPayments(clientKey);

        // ê²°ì œìœ„ì ¯ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        paymentWidget = tossPayments.widgets({
          customerKey: customerKey
        });

        // ê²°ì œ UI ë Œë”ë§
        await renderPaymentWidget();
      } catch (error) {
        console.error('Payment Widget ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        showError('ê²°ì œ ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }

    // ê²°ì œ UI ë Œë”ë§
    async function renderPaymentWidget() {
      try {
        const amount = parseInt(document.getElementById('amount').value);

        // ê²°ì œ ê¸ˆì•¡ ì„¤ì •
        await paymentWidget.setAmount({
          currency: 'KRW',
          value: amount
        });

        // ê²°ì œ ìˆ˜ë‹¨ UI ë Œë”ë§
        await paymentWidget.renderPaymentMethods({
          selector: '#payment-method',
          variantKey: 'DEFAULT'
        });

        // ì•½ê´€ ë™ì˜ UI ë Œë”ë§
        await paymentWidget.renderAgreement({
          selector: '#agreement',
          variantKey: 'AGREEMENT'
        });
      } catch (error) {
        console.error('ê²°ì œ UI ë Œë”ë§ ì‹¤íŒ¨:', error);
        showError('ê²°ì œ UIë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ Payment Widget ì´ˆê¸°í™”
    window.addEventListener('load', initializePaymentWidget);

    // ê¸ˆì•¡ ë³€ê²½ ì‹œ ê²°ì œ UI ì—…ë°ì´íŠ¸
    document.getElementById('amount').addEventListener('change', async function() {
      const amount = parseInt(this.value);
      if (amount >= 1000 && paymentWidget) {
        try {
          await paymentWidget.setAmount({
            currency: 'KRW',
            value: amount
          });
        } catch (error) {
          console.error('ê¸ˆì•¡ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
        }
      }
    });

    // ê²°ì œ ìš”ì²­
    document.getElementById('payment-button').addEventListener('click', async function() {
      const amount = parseInt(document.getElementById('amount').value);
      const orderName = document.getElementById('orderName').value;
      const customerName = document.getElementById('customerName').value;
      const customerEmail = document.getElementById('customerEmail').value;

      // ì…ë ¥ ê°’ ê²€ì¦
      if (amount < 1000) {
        showError('ê²°ì œ ê¸ˆì•¡ì€ ìµœì†Œ 1,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }

      if (!orderName || !customerName || !customerEmail) {
        showError('ëª¨ë“  í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      if (!paymentWidget) {
        showError('ê²°ì œ ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }

      try {
        // ê³ ìœ í•œ ì£¼ë¬¸ ID ìƒì„±
        const orderId = 'order_' + Date.now();

        // ê²°ì œ ìš”ì²­
        await paymentWidget.requestPayment({
          orderId: orderId,
          orderName: orderName,
          successUrl: window.location.origin + window.location.pathname + '?success=true',
          failUrl: window.location.origin + window.location.pathname + '?fail=true',
          customerName: customerName,
          customerEmail: customerEmail
        });
      } catch (error) {
        console.error('ê²°ì œ ìš”ì²­ ì‹¤íŒ¨:', error);
        showError('ê²°ì œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    });

    // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
    function showError(message) {
      const errorElement = document.getElementById('error-message');
      errorElement.textContent = message;
      errorElement.style.display = 'block';

      setTimeout(() => {
        errorElement.style.display = 'none';
      }, 5000);
    }

    // URL íŒŒë¼ë¯¸í„° í™•ì¸ (ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸)
    (function checkPaymentResult() {
      const urlParams = new URLSearchParams(window.location.search);

      // ê²°ì œ ì‹¤íŒ¨ ì²˜ë¦¬
      if (urlParams.get('fail') === 'true' || urlParams.get('code')) {
        showError('ê²°ì œ ì‹¤íŒ¨: ' + (urlParams.get('message') || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
      }

      // ê²°ì œ ì„±ê³µ ì²˜ë¦¬
      if (urlParams.get('success') === 'true' && urlParams.get('paymentKey')) {
        const info = document.querySelector('.info');
        info.innerHTML = `
          <strong>âœ… ê²°ì œ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘</strong><br>
          ê²°ì œ í‚¤: ${urlParams.get('paymentKey')}<br>
          ì£¼ë¬¸ ID: ${urlParams.get('orderId')}<br>
          ê¸ˆì•¡: ${urlParams.get('amount')}ì›<br><br>
          <small>â€» ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì„œë²„ì—ì„œ ìŠ¹ì¸ APIë¥¼ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.</small>
        `;
        info.style.backgroundColor = '#f0fff4';
        info.style.borderLeftColor = '#4caf50';
      }
    })();
  </script>
</body>
</html>
