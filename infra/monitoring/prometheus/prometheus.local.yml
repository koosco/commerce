global:
  scrape_interval: 10s
  evaluation_interval: 10s
  scrape_timeout: 5s
  external_labels:
    monitor: "commerce-monitoring"
    environment: "local"

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# Load rules once and periodically evaluate them
rule_files:
  - "alerts/*.yml"

scrape_configs:
  # Prometheus 자체 모니터링
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # 로컬 Node Exporter (Docker Compose로 실행)
  - job_name: "node-local"
    static_configs:
      - targets: ["node-exporter:9100"]
        labels:
          instance: "local-machine"
          environment: "local"

  # ====================
  # 로컬 개발 환경 - Microservices
  # ====================
  # 로컬에서는 localhost 또는 host.docker.internal 사용

  # Auth Service (로컬)
  - job_name: "auth-service"
    metrics_path: "/actuator/prometheus"
    scrape_interval: 10s
    scrape_timeout: 5s
    static_configs:
      - targets: ["host.docker.internal:8089"] # macOS/Windows Docker Desktop
        # - targets: ['172.17.0.1:8089']  # Linux Docker
        labels:
          service: "auth"
          environment: "local"
          team: "platform"
          tier: "critical"

  # User Service (로컬)
  - job_name: "user-service"
    metrics_path: "/actuator/prometheus"
    scrape_interval: 10s
    scrape_timeout: 5s
    static_configs:
      - targets: ["host.docker.internal:8081"]
        labels:
          service: "user"
          environment: "local"
          team: "user-management"
          tier: "high"

  # Catalog Service (로컬)
  - job_name: "catalog-service"
    metrics_path: "/actuator/prometheus"
    scrape_interval: 10s
    scrape_timeout: 5s
    static_configs:
      - targets: ["host.docker.internal:8084"]
        labels:
          service: "catalog"
          environment: "local"
          team: "product"
          tier: "high"

  # Inventory Service (로컬)
  - job_name: "inventory-service"
    metrics_path: "/actuator/prometheus"
    scrape_interval: 10s
    scrape_timeout: 5s
    static_configs:
      - targets: ["host.docker.internal:8083"]
        labels:
          service: "inventory"
          environment: "local"
          team: "product"
          tier: "critical"

  # Order Service (로컬)
  - job_name: "order-service"
    metrics_path: "/actuator/prometheus"
    scrape_interval: 10s
    scrape_timeout: 5s
    static_configs:
      - targets: ["host.docker.internal:8085"]
        labels:
          service: "order"
          environment: "local"
          team: "order-management"
          tier: "critical"

  # Payment Service (로컬)
  - job_name: "payment-service"
    metrics_path: "/actuator/prometheus"
    scrape_interval: 10s
    scrape_timeout: 5s
    static_configs:
      - targets: ["host.docker.internal:8087"]
        labels:
          service: "payment"
          environment: "local"
          team: "payment"
          tier: "critical"

  # ====================
  # 인프라 Exporter
  # ====================

  # Kafka Exporter (로컬)
  - job_name: 'kafka-exporter'
    static_configs:
      - targets: ['host.docker.internal:9308']
        labels:
          instance: 'kafka'
          environment: 'local'

  # MariaDB Exporter (로컬)
  - job_name: 'mysqld-exporter'
    static_configs:
      - targets: ['host.docker.internal:9104']
        labels:
          instance: 'mariadb'
          environment: 'local'

  # Redis Exporter (로컬)
  - job_name: 'redis-exporter'
    static_configs:
      - targets: ['host.docker.internal:9121']
        labels:
          instance: 'redis'
          environment: 'local'
